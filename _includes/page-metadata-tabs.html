{%- comment -%} Check if any tab has actual content (not empty arrays) {%- endcomment -%}
{%- assign has_contributors = false -%}
{%- assign has_coordinators = false -%}
{%- assign has_editors = false -%}
{%- assign has_affiliations = false -%}
{%- assign has_citations = false -%}

{%- if page.contributors and page.contributors.size > 0 -%}{%- assign has_contributors = true -%}{%- endif -%}
{%- if page.coordinators and page.coordinators.size > 0 -%}{%- assign has_coordinators = true -%}{%- endif -%}
{%- if page.editors and page.editors.size > 0 -%}{%- assign has_editors = true -%}{%- endif -%}
{%- if page.affiliations and page.affiliations.size > 0 -%}{%- assign has_affiliations = true -%}{%- endif -%}
{%- if page.citations and page.citations.size > 0 -%}{%- assign has_citations = true -%}{%- endif -%}

{% if has_contributors or has_coordinators or has_editors or has_affiliations or has_citations %}

{%- comment -%} Determine which tab should be active by default {%- endcomment -%}
{%- assign first_tab = nil -%}
{%- unless first_tab -%}{%- if has_contributors -%}{%- assign first_tab = "contributors" -%}{%- endif -%}{%- endunless -%}
{%- unless first_tab -%}{%- if has_coordinators -%}{%- assign first_tab = "coordinators" -%}{%- endif -%}{%- endunless -%}
{%- unless first_tab -%}{%- if has_editors -%}{%- assign first_tab = "editors" -%}{%- endif -%}{%- endunless -%}
{%- unless first_tab -%}{%- if has_affiliations -%}{%- assign first_tab = "affiliations" -%}{%- endif -%}{%- endunless -%}
{%- unless first_tab -%}{%- if has_citations -%}{%- assign first_tab = "citations" -%}{%- endif -%}{%- endunless -%}

<div class="page-metadata page-credits">
    <nav>
        <div class="nav nav-tabs" id="nav-credits" role="tablist">

            {% if has_contributors %}
            <button class="nav-link {% if first_tab == 'contributors' %}active{% endif %}" id="credits-contributors-tab" data-bs-toggle="tab" data-bs-target="#credits-contributors" type="button" role="tab" aria-controls="credits-contributors" aria-selected="{% if first_tab == 'contributors' %}true{% else %}false{% endif %}">
                <i class="fa-solid fa-handshake"></i>
                Contributors
            </button>
            {% endif %}

            {% if has_coordinators %}
            <button class="nav-link {% if first_tab == 'coordinators' %}active{% endif %}" id="credits-coordinators-tab" data-bs-toggle="tab" data-bs-target="#credits-coordinators" type="button" role="tab" aria-controls="credits-coordinators" aria-selected="{% if first_tab == 'coordinators' %}true{% else %}false{% endif %}">
                <i class="fa-solid fa-crown"></i>
                Coordinators
            </button>
            {% endif %}

            {% if has_editors %}
            <button class="nav-link {% if first_tab == 'editors' %}active{% endif %}" id="credits-editors-tab" data-bs-toggle="tab" data-bs-target="#credits-editors" type="button" role="tab" aria-controls="credits-editors" aria-selected="{% if first_tab == 'editors' %}true{% else %}false{% endif %}">
                <i class="fa-solid fa-comment-dots"></i>
                Editors
            </button>
            {% endif %}

            {% if has_affiliations %}
            <button class="nav-link {% if first_tab == 'affiliations' %}active{% endif %}" id="credits-affiliations-tab" data-bs-toggle="tab" data-bs-target="#credits-affiliations" type="button" role="tab" aria-controls="credits-affiliations" aria-selected="{% if first_tab == 'affiliations' %}true{% else %}false{% endif %}">
                <i class="fa-solid fa-building-columns"></i>
                Affiliations
            </button>
            {% endif %}

            {% if has_citations %}
            <button class="nav-link {% if first_tab == 'citations' %}active{% endif %}" id="credits-cite-tab" data-bs-toggle="tab" data-bs-target="#credits-cite" type="button" role="tab" aria-controls="credits-cite" aria-selected="{% if first_tab == 'citations' %}true{% else %}false{% endif %}">
                <i class="fa-solid fa-quote-left"></i>
                How to cite
            </button>
            {% endif %}

        </div>

    </nav>

    <div class="tab-content" id="nav-creditsContent" style="padding-top: 0.5rem;">

        {% if has_contributors %}
        <div class="tab-pane {% if first_tab == 'contributors' %}show active{% endif %}" id="credits-contributors" role="tabpanel" aria-labelledby="credits-contributors-tab">
            {% include contributors-v2.html contributors_list=page.contributors %}
        </div>
        {% endif %}


        {% if has_coordinators %}
        <div class="tab-pane {% if first_tab == 'coordinators' %}show active{% endif %}" id="credits-coordinators" role="tabpanel" aria-labelledby="credits-coordinators-tab">
            <div class="coordinators">
                {% include contributors-v2.html contributors_list=page.coordinators %}
            </div>
        </div>
        {% endif %}


        {% if has_editors %}
        <div class="tab-pane {% if first_tab == 'editors' %}show active{% endif %}" id="credits-editors" role="tabpanel" aria-labelledby="credits-editors-tab">
            <div class="editors">
                {% include contributors-v2.html contributors_list=page.editors %}
            </div>
        </div>
        {% endif %}

        {% if has_affiliations %}
        <div class="tab-pane {% if first_tab == 'affiliations' %}show active{% endif %}" id="credits-affiliations" role="tabpanel" aria-labelledby="credits-affiliations-tab">
            {% include affiliations-v2.html affiliations_list=page.affiliations %}
        </div>
        {% endif %}

        {% if has_citations %}
        <div class="tab-pane {% if first_tab == 'citations' %}show active{% endif %}" id="credits-citations" role="tabpanel" aria-labelledby="credits-citations-tab">
            {% include citations-v2.html citations_list=page.citations %}
        </div>
        {% endif %}


    </div>
</div>
{% endif %}
